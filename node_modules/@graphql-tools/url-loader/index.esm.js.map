{"version":3,"file":"index.esm.js","sources":["../../../dist/loaders/url/src/index.js"],"sourcesContent":["import { print } from 'graphql';\nimport { observableToAsyncIterable, } from '@graphql-tools/utils';\nimport { isWebUri } from 'valid-url';\nimport { fetch as crossFetch } from 'cross-fetch';\nimport { introspectSchema, makeRemoteExecutableSchema } from '@graphql-tools/wrap';\nimport { SubscriptionClient } from 'subscriptions-transport-ws';\nimport { w3cwebsocket } from 'websocket';\nexport class UrlLoader {\n    loaderId() {\n        return 'url';\n    }\n    async canLoad(pointer, options) {\n        return this.canLoadSync(pointer, options);\n    }\n    canLoadSync(pointer, _options) {\n        return !!isWebUri(pointer);\n    }\n    async load(pointer, options) {\n        let headers = {};\n        let fetch = crossFetch;\n        let defaultMethod = 'POST';\n        let webSocketImpl = w3cwebsocket;\n        if (options) {\n            if (Array.isArray(options.headers)) {\n                headers = options.headers.reduce((prev, v) => ({ ...prev, ...v }), {});\n            }\n            else if (typeof options.headers === 'object') {\n                headers = options.headers;\n            }\n            if (options.customFetch) {\n                if (typeof options.customFetch === 'string') {\n                    const [moduleName, fetchFnName] = options.customFetch.split('#');\n                    fetch = await import(moduleName).then(module => (fetchFnName ? module[fetchFnName] : module));\n                }\n            }\n            if (options.webSocketImpl) {\n                if (typeof options.webSocketImpl === 'string') {\n                    const [moduleName, webSocketImplName] = options.webSocketImpl.split('#');\n                    webSocketImpl = await import(moduleName).then(module => webSocketImplName ? module[webSocketImplName] : module);\n                }\n            }\n            if (options.method) {\n                defaultMethod = options.method;\n            }\n        }\n        const extraHeaders = {\n            Accept: 'application/json',\n            'Content-Type': 'application/json',\n            ...headers,\n        };\n        const HTTP_URL = pointer.replace('ws:', 'http:').replace('wss:', 'https:');\n        const executor = async ({ document, variables, info, }) => {\n            let method = defaultMethod;\n            if (options.useGETForQueries && info.operation.operation === 'query') {\n                method = 'GET';\n            }\n            const fetchResult = await fetch(HTTP_URL, {\n                method,\n                ...(method === 'POST'\n                    ? {\n                        body: JSON.stringify({ query: print(document), variables }),\n                    }\n                    : {}),\n                headers: extraHeaders,\n            });\n            return fetchResult.json();\n        };\n        const schema = await introspectSchema(executor);\n        const remoteExecutableSchemaOptions = {\n            schema,\n            executor,\n        };\n        if (options.enableSubscriptions) {\n            const WS_URL = pointer.replace('http:', 'ws:').replace('https:', 'wss:');\n            const subscriptionClient = new SubscriptionClient(WS_URL, {}, webSocketImpl);\n            remoteExecutableSchemaOptions.subscriber = async ({ document, variables, }) => {\n                return observableToAsyncIterable(subscriptionClient.request({\n                    query: document,\n                    variables,\n                }));\n            };\n        }\n        const remoteExecutableSchema = makeRemoteExecutableSchema(remoteExecutableSchemaOptions);\n        return {\n            location: pointer,\n            schema: remoteExecutableSchema,\n        };\n    }\n    loadSync() {\n        throw new Error('Loader Url has no sync mode');\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["fetch","crossFetch"],"mappings":"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"}